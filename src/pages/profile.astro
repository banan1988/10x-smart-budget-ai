---
import Layout from "../layouts/Layout.astro";
import ProfileView from "../components/ProfileView.tsx";
import { AppHeader } from "../components/AppHeader";
import { AppFooter } from "../components/AppFooter";
import { AppSidebar } from "../components/AppSidebar";
import { MobileNav } from "../components/MobileNav";
import type { ProfilePageVM } from "../types";

const user = Astro.locals.user;

if (!user) {
  return Astro.redirect("/login");
}

const userProfile: ProfilePageVM = {
  email: user.email,
  nickname: user.nickname || null,
  registeredAt: user.createdAt || new Date().toISOString(),
  preferences: null,
};
---

<Layout title="Profil - SmartBudgetAI">
  <div class="flex min-h-screen">
    <div class="hidden lg:block">
      <AppSidebar currentPage="profile" userRole={Astro.locals.user?.role} client:load />
    </div>

    <div class="flex flex-1 flex-col transition-all duration-300" id="main-content">
      <AppHeader
        currentPage="profile"
        userEmail={Astro.locals.user?.email}
        userNickname={Astro.locals.user?.nickname}
        userRole={Astro.locals.user?.role}
        client:load
      />
      <main class="flex-1 bg-background pb-16 lg:pb-0">
        <div class="container mx-auto px-4 py-8">
          <ProfileView userProfile={userProfile} client:load />
        </div>
      </main>
      <AppFooter client:load />
    </div>

    <MobileNav currentPage="profile" client:load />
  </div>
</Layout>
